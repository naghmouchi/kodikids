{% load static %}
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Play & Learn ‚Äî Kodikids</title>
  <link rel="stylesheet" href="{% static 'email_api/css/style.css' %}">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <style>
    html { scroll-behavior: smooth; }
    .animated-title {
      font-size: 2rem;
      font-weight: 800;
      text-align: left;
      color: #2b7cff;
      margin-bottom: 10px;
    }
    @keyframes gradientAnim { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
    .features-subtitle {
      text-align: left;
      font-size: 1rem;
      font-weight: 600;
      background: linear-gradient(90deg, #ff00cc, #3333ff, #00ccff, #ff00cc);
      background-size: 300% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: gradientAnim 4s linear infinite;
      margin-bottom: 30px;
    }
    /* Mini Game Styles */
    .game-container {
      margin: 60px auto;
      text-align: center;
      max-width: 800px;
      padding: 0 20px;
    }
    .game-area {
      position: relative;
      width: 100%;
      height: 300px;
      background-color: #f0f4f8;
      background-image: linear-gradient(#e1e8ed 1px, transparent 1px), linear-gradient(90deg, #e1e8ed 1px, transparent 1px);
      background-size: 20px 20px;
      border: 3px solid #2b7cff;
      border-radius: 12px;
      overflow: hidden;
      margin: 20px auto;
    }
    .sprite {
      position: absolute;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      user-select: none;
      z-index: 10;
    }
    #robot { left: 20px; top: 130px; transition: all 0.1s linear; }
    #obstacle {
      left: 50%; top: 50%; transform: translate(-50%, -50%);
      width: 40px; height: 120px; background: #ff5e57;
      position: absolute; border-radius: 4px;
    }
    #target { right: 20px; top: 130px; font-size: 40px; }
    .game-controls { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
    
    /* Blockly-style buttons */
    .block-btn {
      border: none; padding: 12px 20px; border-radius: 8px;
      cursor: pointer; font-weight: 700; font-size: 0.9rem; color: white;
      box-shadow: 0 4px 0 rgba(0,0,0,0.2); margin: 5px;
      display: inline-flex; align-items: center; gap: 8px;
      transition: transform 0.1s; font-family: sans-serif;
    }
    .block-btn:active { transform: translateY(4px); box-shadow: none; }
    .btn-move { background-color: #4c97ff; } /* Scratch Motion Blue */
    .btn-turn { background-color: #4c97ff; }

    .win-overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.95);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      font-size: 1.5rem; font-weight: bold; color: #00b894;
      z-index: 20; opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .win-overlay.visible { opacity: 1; pointer-events: auto; }
    .confetti {
      position: absolute; width: 8px; height: 8px;
      animation: fall linear forwards; z-index: 15;
    }
    @keyframes fall { to { transform: translateY(300px) rotate(720deg); opacity: 0; } }
    
    /* Footer Styles */
    footer {
      position: relative;
      background: linear-gradient(to bottom, #1a1a2e, #16213e);
      color: #e0e0e0;
      padding: 80px 0 30px;
      margin-top: 80px;
      overflow: hidden;
    }
    .footer-anim-bg {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: 0; overflow: hidden;
      display: flex; flex-wrap: wrap;
    }
    .footer-container {
      position: relative; z-index: 1;
      max-width: 1200px; margin: 0 auto; padding: 0 20px;
    }
    .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 40px;
      margin-bottom: 50px;
      text-align: center;
    }
    .footer-col { display: flex; flex-direction: column; align-items: center; }
    .footer-col h3 {
      color: #4c97ff;
      font-size: 1.4rem;
      margin-bottom: 25px;
      font-weight: 800;
      position: relative;
      display: inline-block;
    }
    .footer-col h3::after {
      content: ''; display: block; width: 50px; height: 3px;
      background: #ff00cc; margin: 10px auto 0; border-radius: 2px;
    }
    .footer-link {
      display: flex; align-items: center; gap: 10px;
      color: #b0b0b0; text-decoration: none; margin-bottom: 15px;
      font-size: 1.1rem; transition: all 0.3s;
    }
    .footer-link:hover { color: #fff; transform: translateX(5px); }
    .footer-copyright {
      text-align: center;
      padding-top: 30px;
      border-top: 1px solid rgba(255,255,255,0.1);
      color: #888; font-size: 0.9rem;
    }
    .anim-cell {
      width: 40px; height: 40px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 50%;
      transform: scale(0.5);
    }
    .card-btn {
      display: inline-block;
      margin-top: 15px;
      padding: 8px 16px;
      background: #ff00cc;
      color: white;
      text-decoration: none;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9rem;
      transition: transform 0.2s;
    }
    .card-btn:hover {
      transform: scale(1.05);
      background: #e600b8;
    }
    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .idea-animation {
      font-size: 10rem;
      position: absolute;
      top: 50%;
      left: 50%;
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
      animation: ideaFlash 4s infinite ease-in-out;
    }
    @keyframes ideaFlash {
      0%, 100% { transform: translate(-50%, -50%) scale(0.9); filter: grayscale(100%); }
      50% { transform: translate(-50%, -50%) scale(1.1); filter: grayscale(0%); text-shadow: 0 0 50px #ffeb3b; }
    }
    .heart-animation {
      font-size: 10rem;
      position: absolute;
      top: 50%;
      left: 50%;
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
      animation: heartPath 6s infinite ease-in-out;
    }
    @keyframes heartPath {
      0% { transform: translate(-50%, -50%) translate(0, 0) scale(1); }
      25% { transform: translate(-50%, -50%) translate(-30px, -20px) scale(1.1); }
      50% { transform: translate(-50%, -50%) translate(0, -40px) scale(1.2); }
      75% { transform: translate(-50%, -50%) translate(30px, -20px) scale(1.1); }
      100% { transform: translate(-50%, -50%) translate(0, 0) scale(1); }
    }
    .card-face h3, .card-face p { position: relative; z-index: 1; }
    .course-animation {
      font-size: 10rem;
      position: absolute;
      top: 50%;
      left: 50%;
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
      animation: floatCourse 5s ease-in-out infinite;
    }
    @keyframes floatCourse {
      0%, 100% { transform: translate(-50%, -50%) translateY(0) rotate(0deg); }
      50% { transform: translate(-50%, -50%) translateY(-20px) rotate(10deg); }
    }
  </style>
</head>
<body>
  <header>
    {% include "email_api/_header.html" %}
  </header>

  <main class="container" id="main">
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-background">
        <h1 id="hero-title" data-lang-key="heroTitle">Apprenez √† coder et piloter des robots ‚Äî enfants & adultes</h1>
        <p id="hero-lead" data-lang-key="heroLead">Parcours ludiques et ateliers pratiques : programmation, IA, jeux √©ducatifs et robotique.</p>
        <p style="margin-top:14px"><a class="cta" href="#start-journey" data-lang-key="heroCTA">Commencer</a></p>
      </div>

      <div class="hero-canvas-wrapper" aria-hidden="false" style="flex:1">
        <div class="hero-decor-bg" aria-hidden="true"></div>
        <canvas id="hero-canvas" role="img" aria-label="Animation de points connect√©s"></canvas>

        <div class="hero-overlay" aria-hidden="false">
          <h2 id="rotating-title" style="margin:0;font-size:20px;opacity:1">Robotic, IA, IoT, Arduino</h2>
          <p id="rotating-sub" style="margin:8px 0 0;color:var(--muted)" data-lang-key="rotatingSub">Des cours gratuits et des projets interactifs accessibles √† tous.</p>
        </div>
      </div>
    </section>

    <div class="container">
      <h1 class="animated-title" data-lang-key="mainTitle">KodiKids : l‚Äôapprentissage du futur</h1>
      <p class="features-subtitle" data-lang-key="mainSubtitle">Accessible √† tous les enfants, aux parents et aux √©ducateurs.</p>
      <div class="carousel">
        <div class="carousel-track">
          <div class="carousel-item">
            <img src="{% static 'email_api/but-non-lucratif.png' %}" alt="Apprends gratuitement" style="width: auto; height: 110px;">
            <h3 data-lang-key="carouselTitle1">Apprends gratuitement</h3>
            <p data-lang-key="carouselDesc1">‚ÄúJoue et Apprends‚Äù est une section √† but non lucratif offrant des cours et des sessions, en ligne ou en pr√©sentiel, gratuitement.</p>
          </div>
          <div class="carousel-item">
            <img src="{% static 'email_api/stem.png' %}" alt="IA pour tous" style="width: auto; height: 110px;">
            <h3 data-lang-key="carouselTitle2">Les principes de l‚Äô√©ducation STEM</h3>
            <p data-lang-key="carouselDesc2">Nos activit√©s encouragent la pens√©e scientifique, technologique, ing√©nierie et math√©matique.</p>
          </div>
          <div class="carousel-item">
            <img src="{% static 'email_api/mission-logo.png' %}" alt="IA pour tous" style="width: auto; height: 110px;">
            <h3 data-lang-key="carouselTitle4">Notre mission</h3>
            <p data-lang-key="carouselDesc4">Notre mission est d‚Äôaccompagner les enfants & adultes dans leur d√©veloppement gr√¢ce √† la robotique ludique, √† l‚Äôintelligence artificielle et √† la cr√©ation d‚Äôapps.</p>
          </div>
          <div class="carousel-item">
            <img src="{% static 'email_api/canada-flag-v1.png' %}" alt="Robots et jeux" style="width: auto; height: 110px;">
            <h3 data-lang-key="carouselTitle3">Curriculum canadien</h3>
            <p data-lang-key="carouselDesc3">Nos activit√©s s‚Äôinspirent des attentes du curriculum canadien.</p>
          </div>
          <div class="carousel-item">
            <img src="{% static 'email_api/network-hub.png' %}" alt="Robots et jeux" style="width: auto; height: 110px;">
            <h3 data-lang-key="carouselTitle5">Rejoindre notre r√©seau</h3>
            <p data-lang-key="carouselDesc5">Nous encourageons les biblioth√®ques et les organismes √† s‚Äôinscrire gratuitement √† nos activit√©s.</p>
          </div>
        </div>
        <button class="carousel-btn prev" aria-label="Pr√©c√©dent">&#10094;</button>
        <button class="carousel-btn next" aria-label="Suivant">&#10095;</button>
      </div>
    </div>

    <h2 id="start-journey" class="animated-title" style="margin-top: 50px; scroll-margin-top: 100px;" data-lang-key="startJourney">Commencer votre parcours</h2>
    <section class="cards" aria-label="programmes">
      <!-- card 1 -->
      <div class="card flip" tabindex="0" aria-labelledby="card1-title">
        <div class="card-inner">
          <div class="card-face card-front" aria-hidden="false">
            <div class="heart-animation">‚ù§Ô∏è</div>
            <h3 id="card1-title" data-lang-key="card1Title">Apprends en t‚Äôamusant, gratuitement</h3>
            <p data-lang-key="card1Desc">Inscris‚Äëtoi √† la prochaine session gratuite et apprends en jouant gr√¢ce √† nos cours gratuits.</p>
          </div>
          <div class="card-face card-back" aria-hidden="true">
            <h3 data-lang-key="card1BackTitle">Cette section est √† but non lucratif</h3>
            <p data-lang-key="card1BackDesc">Inscris‚Äëtoi gratuitement √† la prochaine session et profite de nos cours, simulateurs, jeux et quiz.</p>
            <a href="/api/play/playandlearn/" class="card-btn" data-lang-key="learnMore">Savoir plus</a>
          </div>
        </div>
      </div>

      <!-- card 2 (flip) -->
      <div class="card flip" tabindex="0" aria-labelledby="card2-title">
        <div class="card-inner">
          <div class="card-face card-front" aria-hidden="false">
            <div class="course-animation">üéì</div>
            <h3 id="card2-title" data-lang-key="card2Title">Tu cherches un cours sp√©cifique pour ton enfant</h3>
            <p data-lang-key="card2Desc">Choisis l‚Äôun de nos cours et inscris‚Äëtoi : robotique & IoT, IA, Arduino, PowerPoint & Canva, Python & Scratch.</p>
          </div>
          <div class="card-face card-back" aria-hidden="true">
            <h3 data-lang-key="card2BackTitle">Cours en groupe ou individuels</h3>
            <p data-lang-key="card2BackDesc">Choisis ton cours</p>
            <a href="/api/courses/" class="card-btn" data-lang-key="learnMore">Savoir plus</a>
          </div>
        </div>
      </div>

      <!-- card 3 (flip) -->
      <div class="card flip" tabindex="0" aria-labelledby="card3-title">
        <div class="card-inner">
          <div class="card-face card-front" aria-hidden="false">
            <div class="idea-animation">üí°</div>
            <h3 id="card3-title" data-lang-key="card3Title">Tu as une id√©e de projet?</h3>
            <p data-lang-key="card3Desc">Nous vous accompagnons pour apprendre √† cr√©er votre application de A √† Z gr√¢ce √† nos labs pratiques.</p>
          </div>
          <div class="card-face card-back" aria-hidden="true">
            <h3 data-lang-key="card3BackTitle">Explique‚Äënous ton id√©e de projet</h3>
            <p data-lang-key="card3BackDesc">Envoie‚Äënous ta demande de projet (app web/mobile, automatisation, jeu, robotique, etc.).</p>
            <a href="/api/coaching/" class="card-btn" data-lang-key="learnMore">Savoir plus</a>
          </div>
        </div>
      </div>
    </section>

    <section class="game-container">
      <h2 data-lang-key="gameTitle">Mission : Contact</h2>
      <p data-lang-key="gameDesc">Programmez le robot ü§ñ pour envoyer un email üìß en √©vitant le mur !</p>
      <div class="game-area" id="gameArea">
        <div id="robot" class="sprite">ü§ñ</div>
        <div id="obstacle"></div>
        <div id="target" class="sprite">üìß</div>
        <div id="winOverlay" class="win-overlay">
          <div data-lang-key="gameWin">üéâ Gagn√© !</div>
          <div style="font-size: 1rem; color: #555; margin-top: 10px;"><span data-lang-key="gameRedirect">Redirection vers Contact dans</span> <span id="gameTimer">3</span>s...</div>
        </div>
      </div>
      <div class="game-controls">
        <button class="block-btn btn-move" onclick="gameAction('forward')" data-lang-key="btnForward">Avancer</button>
        <button class="block-btn btn-turn" onclick="gameAction('left')" data-lang-key="btnLeft">‚Ü∫ Gauche</button>
        <button class="block-btn btn-turn" onclick="gameAction('right')" data-lang-key="btnRight">Droite ‚Üª</button>
      </div>
    </section>
  </main>

  <div id="cookie-banner" class="cookie-banner">
    <p data-lang-key="cookieText">En cliquant sur "Accepter", vous acceptez notre <a href="/api/confidentialite/" style="color: #4c97ff; text-decoration: underline;">politique de confidentialit√©</a>.</p>
    <button id="cookie-accept-btn" class="cookie-accept-btn" data-lang-key="cookieAccept">Accepter</button>
  </div>

  <footer>
    <div class="footer-anim-bg"></div>
    <div class="footer-container">
      <div class="footer-grid">
        <div class="footer-col">
          <h3 data-lang-key="footerPages">Pages</h3>
          <a href="/" class="footer-link" data-lang-key="navHome">üè† Accueil</a>
          <a href="/api/courses/" class="footer-link" data-lang-key="navCourses">üéì Cours</a>
          <a href="/api/contact/" class="footer-link" data-lang-key="navContact">üì¨ Contact</a>
        </div>
        <div class="footer-col">
          <h3 data-lang-key="footerFollow">Suivez-nous</h3>
          <a href="https://www.facebook.com/share/14SuZoRnHDK/?mibextid=wwXIfr" class="footer-link" target="_blank">
            <img src="{% static 'email_api/icons8-facebook-48.png' %}" alt="Facebook" style="width: 24px; height: 24px; border-radius: 4px;">
            <span data-lang-key="socialFb">kodikids</span>
          </a>
          <a href="https://www.youtube.com/@kodikids-robotics" class="footer-link" target="_blank">
            <img src="{% static 'email_api/icons8-youtube-48.png' %}" alt="YouTube" style="width: 24px; height: 24px;">
            <span data-lang-key="socialYt">@kodikids-robotics</span>
          </a>
          <a href="https://www.tiktok.com/@kodikids.ca?is_from_webapp=1&sender_device=pc" class="footer-link" target="_blank">
            <img src="{% static 'email_api/icons8-tiktok-48.png' %}" alt="TikTok" style="width: 24px; height: 24px;">
            <span data-lang-key="socialTt">kodikids.ca</span>
          </a>
        </div>
        <div class="footer-col">
          <h3 data-lang-key="footerContact">Contact</h3>
          <a href="mailto:contact@kodikids.com" class="footer-link">üìß contact@kodikids.com</a>
          <a href="tel:+1234567890" class="footer-link">üìû +1 234 567 890</a>
        </div>
      </div>
      <div class="footer-copyright">
        <span data-lang-key="footerText">¬© Kodikids ‚Äî Enseignement de la programmation, des robots et de l'IA</span>
      </div>
    </div>
  </footer>

  <script>
  (function(){
    // Particle + linking animation inside hero canvas
    const wrapper = document.querySelector('.hero-canvas-wrapper');
    const canvas = document.getElementById('hero-canvas');
    if(!wrapper || !canvas) return;
    const ctx = canvas.getContext('2d');
    let DPR = Math.max(1, window.devicePixelRatio || 1);
    const COLORS = ['#2b7cff','#ff7a7a','#7af0b3','#f0d36a'];
    let particles = [];
    const MAX_DIST = 140;

    function resize(){
      DPR = Math.max(1, window.devicePixelRatio || 1);
      const w = Math.max(200, Math.floor(wrapper.clientWidth));
      const h = Math.max(120, Math.floor(wrapper.clientHeight));
      canvas.width = Math.floor(w * DPR);
      canvas.height = Math.floor(h * DPR);
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function initParticles(){
      particles = [];
      const W = wrapper.clientWidth, H = wrapper.clientHeight;
      const count = Math.min(60, Math.max(18, Math.round(W/35)));
      for(let i=0;i<count;i++){
        particles.push({
          x: rand(0,W),
          y: rand(0,H),
          vx: rand(-0.5,0.5),
          vy: rand(-0.5,0.5),
          r: rand(2.2,4.6),
          c: COLORS[i % COLORS.length]
        });
      }
    }

    let mouse = {x:-9999,y:-9999,active:false};
    wrapper.addEventListener('mousemove', function(e){
      const r = wrapper.getBoundingClientRect();
      mouse.x = e.clientX - r.left;
      mouse.y = e.clientY - r.top;
      mouse.active = true;
    });
    wrapper.addEventListener('touchmove', function(e){
      const r = wrapper.getBoundingClientRect();
      const t = e.touches[0];
      if(t){ mouse.x = t.clientX - r.left; mouse.y = t.clientY - r.top; mouse.active = true; }
    }, {passive:true});
    wrapper.addEventListener('mouseleave', function(){ mouse.active=false; mouse.x=-9999; mouse.y=-9999; });
    window.addEventListener('resize', function(){ resize(); initParticles(); });

    function hexToRgba(hex,a){
      const h = hex.replace('#','');
      const bigint = parseInt(h,16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return 'rgba('+r+','+g+','+b+','+(a||1)+')';
    }

    function step(){
      const W = wrapper.clientWidth, H = wrapper.clientHeight;
      ctx.clearRect(0,0,W,H);

      // update
      for(let p of particles){
        p.x += p.vx;
        p.y += p.vy;
        if(p.x < 0 || p.x > W) p.vx *= -1;
        if(p.y < 0 || p.y > H) p.vy *= -1;
        if(mouse.active){
          const dx = p.x - mouse.x, dy = p.y - mouse.y;
          const d = Math.sqrt(dx*dx + dy*dy);
          if(d < 80 && d > 0){
            p.vx += (dx/d)*0.03;
            p.vy += (dy/d)*0.03;
          }
        }
      }

      // draw lines
      for(let i=0;i<particles.length;i++){
        for(let j=i+1;j<particles.length;j++){
          const a = particles[i], b = particles[j];
          const dx = a.x - b.x, dy = a.y - b.y;
          const d = Math.sqrt(dx*dx + dy*dy);
          if(d < MAX_DIST){
            const alpha = 1 - d / MAX_DIST;
            ctx.beginPath();
            ctx.moveTo(a.x, a.y);
            ctx.lineTo(b.x, b.y);
            const grad = ctx.createLinearGradient(a.x,a.y,b.x,b.y);
            grad.addColorStop(0, hexToRgba(a.c, 0.9*alpha));
            grad.addColorStop(1, hexToRgba(b.c, 0.9*alpha));
            ctx.strokeStyle = grad;
            ctx.lineWidth = 0.8 + alpha*1.2;
            ctx.stroke();
          }
        }
      }

      // draw points
      for(let p of particles){
        ctx.beginPath();
        ctx.fillStyle = p.c;
        ctx.globalAlpha = 0.95;
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      requestAnimationFrame(step);
    }

    // init
    resize();
    initParticles();
    requestAnimationFrame(step);
  })();
  </script>

  <script>
  (function(){
    // rotating title: Robot & IA Learning -> Play and Learning -> Coding games
    const titlesFr = ['Robot, IA, IoT & Arduino', 'Inscris‚Äëtoi √† des sessions d‚Äôapprentissage gratuites', 'Creation d‚ÄôApplication Web & Mobile ', ' Joue et apprends', 'Ma√Ætrise l‚Äôart de la pr√©sentation PowerPoint & Canva', 'Pr√©pare ta carri√®re Tech', 'Code des jeux amusants & √©ducatifs', 'Construis des robots intelligents', 'D√©couvre les bases de l‚ÄôIA & du Machine Learning', 'R√©alise tes projets en apprenant √† coder'];
    const titlesEn = ['Robot, AI, IoT & Arduino', 'Sign up for free learning sessions', 'Web & Mobile App Creation', 'Play and Learn', 'Master PowerPoint & Canva presentation', 'Prepare for your Tech career', 'Code fun & educational games', 'Build smart robots', 'Discover AI & Machine Learning basics', 'Build your projects by learning to code'];
    const el = document.getElementById('rotating-title');
    if(!el) return;
    let idx = 0;
    const interval = 2600;
    function showNext(){
      const lang = document.documentElement.lang || 'fr';
      const titles = lang === 'en' ? titlesEn : titlesFr;
      el.style.opacity = '0';
      setTimeout(()=>{
        idx = (idx + 1) % titles.length;
        el.textContent = titles[idx];
        el.style.opacity = '1';
      }, 420);
    }
    // start after a short delay
    setTimeout(()=>{ setInterval(showNext, interval); }, interval);
  })();
  </script>

  <script>
  (function(){
    const track = document.querySelector('.carousel-track');
    if (!track) return;

    const items = track.querySelectorAll('.carousel-item');
    const prevBtn = document.querySelector('.carousel-btn.prev');
    const nextBtn = document.querySelector('.carousel-btn.next');
    let index = 0;

    function getVisibleItems() {
      if (window.innerWidth >= 900) return 3;
      if (window.innerWidth >= 600) return 2;
      return 1;
    }

    function updateCarousel() {
      const itemWidth = items[0].offsetWidth;
      const gap = parseInt(window.getComputedStyle(track).gap) || 16;
      track.style.transform = `translateX(-${index * (itemWidth + gap)}px)`;
      prevBtn.style.display = index === 0 ? 'none' : 'flex';
      nextBtn.style.display = index >= items.length - getVisibleItems() ? 'none' : 'flex';
    }

    nextBtn.addEventListener('click', () => { if (index < items.length - getVisibleItems()) { index++; updateCarousel(); } });
    prevBtn.addEventListener('click', () => { if (index > 0) { index--; updateCarousel(); } });
    window.addEventListener('resize', updateCarousel);
    updateCarousel(); // Initial call
  })();
  </script>

  <script>
  (function() {
    // Language switcher logic
    const langSwitcher = document.getElementById('lang-switcher');
    if (!langSwitcher) return;

    const translations = {
      en: {
        heroTitle: "Learn to code and control robots ‚Äî kids & adults",
        heroLead: "Fun paths and practical workshops: programming, AI, educational games, and robotics.",
        heroCTA: "Start",
        rotatingSub: "Free courses and interactive projects accessible to everyone.",
        carouselTitle1: "Learn for free",
        carouselDesc1: "‚ÄúPlay and Learn‚Äù is a non-profit section offering courses and sessions, online or in-person, for free.",
        carouselTitle2: "STEM Education Principles",
        carouselDesc2: "Our activities encourage scientific, technological, engineering, and mathematical thinking.",
        carouselTitle3: "Canadian Curriculum",
        carouselDesc3: "Our activities are inspired by the expectations of the Canadian curriculum.",
        carouselTitle4: "Our Mission",
        carouselDesc4: "Our mission is to support children & adults in their development through fun robotics, artificial intelligence, and app creation.",
        carouselTitle5: "Join Our Network",
        carouselDesc5: "We encourage libraries and organizations to register for our activities for free.",
        startJourney: "Start your journey",
        card1Title: "Learn while having fun, for free",
        card1Desc: "Sign up for the next free session and learn by playing with our free courses.",
        card1BackTitle: "This section is non-profit",
        card1BackDesc: "Register for free for the next session and enjoy our courses, simulators, games, and quizzes.",
        learnMore: "Learn more",
        card2Title: "Looking for a specific course for your child?",
        card2Desc: "Choose one of our courses and sign up: Robotics & IoT, AI, Arduino, PowerPoint & Canva, Python & Scratch.",
        card2BackTitle: "Group or Individual Courses",
        card2BackDesc: "Choose your course",
        card3Title: "Have a project idea?",
        card3Desc: "We guide you to learn how to create your application from A to Z through our practical labs.",
        card3BackTitle: "Tell us about your project idea",
        card3BackDesc: "Send us your project request (web/mobile app, automation, game, robotics, etc.).",
        footerText: "¬© Play & Learn ‚Äî Teaching programming, robots, and AI",
        cookieText: "By clicking \"Accept\", you agree to our <a href='/api/confidentialite/' style='color: #4c97ff; text-decoration: underline;'>privacy policy</a>.",
        cookieAccept: "Accept",
        mainTitle: "KodiKids: Learning for the Future",
        mainSubtitle: "Accessible to all children, parents, and educators.",
        gameTitle: "Mission: Contact",
        gameDesc: "Program the robot ü§ñ to send an email üìß while avoiding the wall!",
        gameWin: "üéâ You Win!",
        gameRedirect: "Redirecting to Contact in",
        btnForward: "Forward",
        btnLeft: "‚Ü∫ Left",
        btnRight: "Right ‚Üª",
        footerPages: "Pages",
        footerFollow: "Follow Us",
        footerContact: "Contact",
        navHome: "üè† Home",
        navCourses: "üéì Courses",
        navContact: "üì¨ Contact",
        socialFb: "Facebook",
        socialYt: "YouTube",
        socialTt: "TikTok"
      },
      fr: {
        heroTitle: "Apprenez √† coder et piloter des robots ‚Äî enfants & adultes",
        heroLead: "Parcours ludiques et ateliers pratiques : programmation, IA, jeux √©ducatifs et robotique.",
        heroCTA: "Commencer",
        rotatingSub: "Des cours gratuits et des projets interactifs accessibles √† tous.",
        carouselTitle1: "Apprends gratuitement",
        carouselDesc1: "‚ÄúJoue et Apprends‚Äù est une section √† but non lucratif offrant des cours et des sessions, en ligne ou en pr√©sentiel, gratuitement.",
        carouselTitle2: "Les principes de l‚Äô√©ducation STEM",
        carouselDesc2: "Nos activit√©s encouragent la pens√©e scientifique, technologique, ing√©nierique et math√©matique.",
        carouselTitle3: "Curriculum canadien",
        carouselDesc3: "Nos activit√©s s‚Äôinspirent des attentes du curriculum canadien.",
        carouselTitle4: "Notre mission",
        carouselDesc4: "Notre mission est d‚Äôaccompagner les enfants & adultes dans leur d√©veloppement gr√¢ce √† la robotique ludique, √† l‚Äôintelligence artificielle et √† la cr√©ation d‚Äôapps.",
        carouselTitle5: "Rejoindre notre r√©seau",
        carouselDesc5: "Nous encourageons les biblioth√®ques et les organismes √† s‚Äôinscrire gratuitement √† nos activit√©s.",
        startJourney: "Commencer votre parcours",
        card1Title: "Apprends en t‚Äôamusant, gratuitement",
        card1Desc: "Inscris‚Äëtoi √† la prochaine session gratuite et apprends en jouant gr√¢ce √† nos cours gratuits.",
        card1BackTitle: "Cette section est √† but non lucratif",
        card1BackDesc: "Inscris‚Äëtoi gratuitement √† la prochaine session et profite de nos cours, simulateurs, jeux et quiz.",
        learnMore: "Savoir plus",
        card2Title: "Tu cherches un cours sp√©cifique pour ton enfant",
        card2Desc: "Choisis l‚Äôun de nos cours et inscris‚Äëtoi : robotique & IoT, IA, Arduino, PowerPoint & Canva, Python & Scratch.",
        card2BackTitle: "Cours en groupe ou individuels",
        card2BackDesc: "Choisis ton cours",
        card3Title: "Tu as une id√©e de projet?",
        card3Desc: "Nous vous accompagnons pour apprendre √† cr√©er votre application de A √† Z gr√¢ce √† nos labs pratiques.",
        card3BackTitle: "Explique‚Äënous ton id√©e de projet",
        card3BackDesc: "Envoie‚Äënous ta demande de projet (app web/mobile, automatisation, jeu, robotique, etc.).",
        footerText: "¬© Play & Learn ‚Äî Enseignement de la programmation, des robots et de l'IA",
        cookieText: "En cliquant sur 'Accepter', vous acceptez notre <a href='/api/confidentialite/' style='color: #4c97ff; text-decoration: underline;'>politique de confidentialit√©</a>.",
        cookieAccept: "Accepter",
        mainTitle: "KodiKids : l‚Äôapprentissage du futur",
        mainSubtitle: "Accessible √† tous les enfants, aux parents et aux √©ducateurs.",
        gameTitle: "Mission : Contact",
        gameDesc: "Programmez le robot ü§ñ pour envoyer un email üìß en √©vitant le mur !",
        gameWin: "üéâ Gagn√© !",
        gameRedirect: "Redirection vers Contact dans",
        btnForward: "Avancer",
        btnLeft: "‚Ü∫ Gauche",
        btnRight: "Droite ‚Üª",
        footerPages: "Pages",
        footerFollow: "Suivez-nous",
        footerContact: "Contact",
        navHome: "üè† Accueil",
        navCourses: "üéì Cours",
        navContact: "üì¨ Contact",
        socialFb: "Facebook",
        socialYt: "YouTube",
        socialTt: "TikTok"
      }
    };

    let currentLang = 'fr';

    function setLanguage(lang) {
      const trans = translations[lang];
      document.querySelectorAll('[data-lang-key]').forEach(el => {
        const key = el.dataset.langKey;
        if (trans[key]) {
          el.innerHTML = trans[key];
        }
      });
      currentLang = lang;
      langSwitcher.textContent = lang === 'fr' ? 'EN' : 'FR';
      document.documentElement.lang = lang;
    }

    langSwitcher.addEventListener('click', () => {
      const newLang = currentLang === 'fr' ? 'en' : 'fr';
      setLanguage(newLang);
    });

  })();
  </script>

  <script>
  (function(){
    // Mini Game Logic
    const robot = document.getElementById('robot');
    const obstacle = document.getElementById('obstacle');
    const target = document.getElementById('target');
    const gameArea = document.getElementById('gameArea');
    const winOverlay = document.getElementById('winOverlay');
    const timerSpan = document.getElementById('gameTimer');
    
    if(!robot || !gameArea) return;

    let robotX = 20, robotY = 130;
    let robotAngle = 0; // 0 = Right
    const step = 20;
    let gameWon = false;

    // --- Sound Effects (Synth) ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        
        const now = audioCtx.currentTime;
        if(type === 'move') {
            osc.frequency.setValueAtTime(300, now);
            osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
            osc.start(); osc.stop(now + 0.1);
        } else if(type === 'bump') {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(50, now + 0.2);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
            osc.start(); osc.stop(now + 0.2);
        } else if(type === 'win') {
            osc.type = 'square';
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.setValueAtTime(600, now + 0.1);
            osc.frequency.setValueAtTime(1000, now + 0.2);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.6);
            osc.start(); osc.stop(now + 0.6);
        }
    }

    function spawnConfetti() {
        for(let i=0; i<40; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.left = Math.random() * 100 + '%';
            c.style.top = '-10px';
            c.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
            c.style.animationDuration = (Math.random() * 1.5 + 0.5) + 's';
            gameArea.appendChild(c);
        }
    }

    function updatePos() {
        robot.style.left = robotX + 'px';
        robot.style.top = robotY + 'px';
        robot.style.transform = `rotate(${robotAngle}deg)`;
        checkCollision();
    }

    function checkCollision() {
        if(gameWon) return;
        const rRect = robot.getBoundingClientRect(); // Use visual rect for simplicity with transition
        // To be more precise with responsive layout, we calculate logical rect relative to viewport:
        const aRect = gameArea.getBoundingClientRect();
        const rLeft = aRect.left + robotX;
        const rTop = aRect.top + robotY;
        const rRight = rLeft + 40;
        const rBottom = rTop + 40;

        const oRect = obstacle.getBoundingClientRect();
        const tRect = target.getBoundingClientRect();

        // Boundaries
        if (robotX < 0) robotX = 0;
        if (robotY < 0) robotY = 0;
        if (robotX > aRect.width - 40) robotX = aRect.width - 40;
        if (robotY > aRect.height - 40) robotY = aRect.height - 40;

        // Obstacle Collision
        const pad = 5;
        if (!(rRight < oRect.left + pad || rLeft > oRect.right - pad || rBottom < oRect.top + pad || rTop > oRect.bottom - pad)) {
            robotX = 20; robotY = 130; // Reset
            robot.style.left = robotX + 'px'; robot.style.top = robotY + 'px';
            gameArea.style.backgroundColor = '#ffecec';
            playSound('bump');
            setTimeout(() => gameArea.style.backgroundColor = '#f0f4f8', 200);
            return;
        }

        // Target Collision
        if (!(rRight < tRect.left || rLeft > tRect.right || rBottom < tRect.top || rTop > tRect.bottom)) {
            gameWon = true;
            playSound('win');
            spawnConfetti();
            winOverlay.classList.add('visible');
            let timeLeft = 3;
            const interval = setInterval(() => {
                timeLeft--;
                if(timerSpan) timerSpan.textContent = timeLeft;
                if(timeLeft <= 0) { clearInterval(interval); window.location.href = '/api/contact/'; }
            }, 1000);
        }
    }

    window.gameAction = function(action) {
        if(gameWon) return;
        
        if(action === 'left') {
            robotAngle -= 90;
            playSound('move');
        } else if(action === 'right') {
            robotAngle += 90;
            playSound('move');
        } else if(action === 'forward') {
            const rad = robotAngle * (Math.PI / 180);
            const dx = Math.round(Math.cos(rad)) * step;
            const dy = Math.round(Math.sin(rad)) * step;
            robotX += dx;
            robotY += dy;
            playSound('move');
        }
        updatePos();
    };

    document.addEventListener('keydown', (e) => {
        if(gameWon) return;
        if(e.key === 'ArrowUp') { e.preventDefault(); gameAction('forward'); }
        if(e.key === 'ArrowLeft') { e.preventDefault(); gameAction('left'); }
        if(e.key === 'ArrowRight') { e.preventDefault(); gameAction('right'); }
    });
  })();
  </script>

  <script>
  (function() {
    // Cookie Consent Banner
    const banner = document.getElementById('cookie-banner');
    const acceptBtn = document.getElementById('cookie-accept-btn');
    const cookieConsentKey = 'kodikids_cookie_consent';

    if (!localStorage.getItem(cookieConsentKey)) {
      banner.style.display = 'flex';
    }

    acceptBtn.addEventListener('click', () => {
      localStorage.setItem(cookieConsentKey, 'true');
      banner.style.display = 'none';
    });
  })();
  </script>

  <script>
  (function(){
    // Footer Animation with Anime.js
    const bg = document.querySelector('.footer-anim-bg');
    const footer = document.querySelector('footer');
    if(!bg || !footer) return;

    const cellSize = 40;
    let cols, rows;

    function createGrid() {
        bg.innerHTML = '';
        const w = footer.offsetWidth;
        const h = footer.offsetHeight;
        cols = Math.ceil(w / cellSize);
        rows = Math.ceil(h / cellSize);
        bg.style.width = w + 'px';
        bg.style.height = h + 'px';
        
        for (let i = 0; i < cols * rows; i++) {
            const el = document.createElement('div');
            el.classList.add('anim-cell');
            bg.appendChild(el);
        }
        
        // Initial random fade in
        anime({
            targets: '.anim-cell',
            opacity: [0, 0.5],
            delay: anime.stagger(50, {grid: [cols, rows], from: 'center'}),
            easing: 'easeOutQuad'
        });
    }

    createGrid();
    window.addEventListener('resize', createGrid);

    // Idle Animation: Random blinking dots
    function animateRandom() {
        const cells = document.querySelectorAll('.anim-cell');
        if(cells.length === 0) {
            setTimeout(animateRandom, 500);
            return;
        }
        
        const index = Math.floor(Math.random() * cells.length);
        
        anime({
            targets: cells[index],
            scale: [
                {value: 0.85, duration: 500, easing: 'easeInOutQuad'},
                {value: 0.5, duration: 500, easing: 'easeInOutQuad'}
            ],
            opacity: [
                {value: 1, duration: 500, easing: 'linear'},
                {value: 0.5, duration: 500, easing: 'linear'}
            ],
            backgroundColor: [
                {value: Math.random() > 0.5 ? '#4c97ff' : '#ff00cc', duration: 500, easing: 'easeInOutQuad'},
                {value: 'rgba(255, 255, 255, 0.03)', duration: 500, easing: 'easeInOutQuad'}
            ],
            complete: function() {
                setTimeout(animateRandom, Math.random() * 1500 + 500);
            }
        });
    }
    // Start multiple loops for random activity
    setTimeout(animateRandom, 1000);
    setTimeout(animateRandom, 2500);
    setTimeout(animateRandom, 4000);

    footer.addEventListener('click', function(e) {
        const rect = footer.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const col = Math.floor(x / cellSize);
        const row = Math.floor(y / cellSize);
        const index = col + row * cols;

        anime({
            targets: '.anim-cell',
            scale: [
                {value: 0.1, easing: 'easeOutSine', duration: 500},
                {value: 0.5, easing: 'easeInOutQuad', duration: 1200}
            ],
            backgroundColor: [
                {value: '#4c97ff', easing: 'easeOutSine', duration: 500},
                {value: 'rgba(255, 255, 255, 0.03)', easing: 'easeInOutQuad', duration: 1200}
            ],
            delay: anime.stagger(50, {grid: [cols, rows], from: index})
        });
    });
  })();
  </script>
</body>
</html>