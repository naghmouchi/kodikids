{% load static %}
<header style="position: relative;">
  <style>
    .header-anim-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; }
    .header-path-svg { width: 100%; height: 100%; opacity: 0.6; }

    /* Animation "brillante" pour le bouton S'inscrire */
    .submenu-list .cta[data-lang-key="headerRegister"] {
        background: linear-gradient(135deg, #8a5fb9, #764ba2, #667eea, #764ba2, #8a5fb9);
        background-size: 250% auto;
        animation: shine-button 4s linear infinite;
    }

    @keyframes shine-button {
        to { background-position: 250% center; }
    }

  </style>
  <div class="header-anim-bg">
    <svg class="header-path-svg" viewBox="0 0 1000 100" preserveAspectRatio="none">
      <path id="hPath1" d="M-20,20 Q300,80 500,20 T1020,50" fill="none" stroke="rgba(43, 124, 255, 0.15)" stroke-width="2" vector-effect="non-scaling-stroke" />
      <circle r="4" fill="#2b7cff">
        <animateMotion dur="18s" repeatCount="indefinite" rotate="auto">
          <mpath href="#hPath1"/>
        </animateMotion>
      </circle>
      <path id="hPath2" d="M-20,80 Q300,20 500,80 T1020,40" fill="none" stroke="rgba(255, 0, 204, 0.15)" stroke-width="2" vector-effect="non-scaling-stroke" />
      <circle r="3" fill="#ff00cc">
        <animateMotion dur="25s" repeatCount="indefinite" rotate="auto">
          <mpath href="#hPath2"/>
        </animateMotion>
      </circle>
    </svg>
  </div>
  <div class="container nav-inner" style="position: relative; z-index: 1;">
    <a class="brand" href="/">
      <div class="logo">
         <img src="{% static 'email_api/logo.png' %}" alt="KodiKids logo" />
      </div>
      <div>
        <div style="font-weight:700">KodiKids</div>
        <small style="color:var(--muted);font-weight:600" data-lang-key="headerSubtitle">Coding, Robot & IA</small>
      </div>
    </a>

    <nav>
      <button type="button" id="hamburger" class="hamburger" aria-controls="main-nav" aria-expanded="false" aria-label="Ouvrir le menu">‚ò∞</button>

      <ul id="main-nav" role="menubar" aria-hidden="false">
        <li role="none"><a role="menuitem" href="/" data-lang-key="headerHome">Accueil</a></li>
        <li role="none"><a role="menuitem" href="/api/courses/" data-lang-key="headerCourses">Cours</a></li>
        <li role="none"><a role="menuitem" href="/api/coaching/" data-lang-key="headerCoaching">Encadrement</a></li>
        

        <li class="submenu" role="none">
          <button class="submenu-toggle" aria-haspopup="true" aria-expanded="false" id="playToggle" data-lang-key="headerPlay">Joue & Apprends ‚ñæ</button>
          <div class="submenu-list" id="submenu" role="menu" aria-label="Play and learn submenu">
            <a role="menuitem" href="/api/play/tutorials/" style="font-weight:bold; color:#764ba2;" data-lang-key="headerTutorials">üöÄ Tous les Tutoriels</a>
            <a role="menuitem" href="/api/play/games/" style="font-weight:bold; color:#764ba2;" data-lang-key="headerGames">üéÆ Tous les Jeux</a>
            <a role="menuitem" href="/api/play/quiz/" style="font-weight:bold; color:#764ba2;" data-lang-key="headerQuiz">‚ùì Tous les Quiz</a>
            <a role="menuitem" href="/api/play/robotics/" style="font-weight:bold; color:#764ba2;" data-lang-key="headerRobotics">ü§ñ Robotique</a>
            <a role="menuitem" href="/api/play/playandlearn/" class="cta" style="margin-top:10px; display:block; text-align:center; font-size:0.9rem;" data-lang-key="headerRegister">S'inscrire gratuitement</a>
            
          </div>
        </li>

        <li role="none"><a role="menuitem" href="#" style="background: linear-gradient(135deg, #FF512F 0%, #DD2476 100%); color: white; padding: 8px 20px; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 15px rgba(221, 36, 118, 0.3);" data-lang-key="headerDonation">‚ù§Ô∏è Faire un don</a></li>
        <li role="none"><a role="menuitem" class="cta" href="/api/contact/" data-lang-key="headerContact">Contact</a></li>
        <li role="none"><button id="lang-switcher" type="button" class="lang-btn" title="Switch language">EN</button></li>
      </ul>
    </nav>
  </div>
</header>

<script>
  (function(){
    // NAV / submenu logic (robust cross-browser)
    const hamb = document.getElementById('hamburger');
    const nav = document.getElementById('main-nav');
    const playToggle = document.getElementById('playToggle');
    const submenu = document.getElementById('submenu');

    function setExpanded(el, v){ if(!el) return; el.setAttribute('aria-expanded', v ? 'true' : 'false'); }

    function toggleNav(e){
      if(e) e.preventDefault();
      if(!nav) return;
      const open = nav.classList.toggle('open');
      setExpanded(hamb, open);
      if(!open && submenu){ submenu.style.display=''; setExpanded(playToggle,false); }
    }
    if(hamb){
      hamb.addEventListener('click', toggleNav);
      hamb.addEventListener('touchstart', function(e){ e.preventDefault(); toggleNav(e); }, {passive:false});
    }

    function toggleSubmenu(e){
      if(!submenu || !playToggle) return;
      if(e) e.preventDefault();
      const open = submenu.style.display === 'block';
      submenu.style.display = open ? 'none' : 'block';
      setExpanded(playToggle, !open);
    }
    if(playToggle){
      playToggle.addEventListener('click', toggleSubmenu);
      playToggle.addEventListener('keydown', function(e){
        if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){ e.preventDefault(); toggleSubmenu(e); }
        if(e.key==='Escape'){ submenu.style.display='none'; setExpanded(playToggle,false); playToggle.blur(); }
      });
    }

    document.addEventListener('click', function(evt){
      const t = evt.target;
      if(window.matchMedia('(max-width:900px)').matches){
        if(nav && !nav.contains(t) && nav.classList.contains('open')){ nav.classList.remove('open'); setExpanded(hamb,false); }
        if(submenu && !submenu.contains(t) && playToggle && playToggle !== t){ submenu.style.display='none'; setExpanded(playToggle,false); }
      }
    }, true);

    window.addEventListener('resize', function(){
      if(window.innerWidth > 900){ if(nav){ nav.classList.remove('open'); setExpanded(hamb,false); } if(submenu){ submenu.style.display=''; setExpanded(playToggle,false); } }
    });
  })();

  (function(){
    // Header Translation Logic
    const langSwitcher = document.getElementById('lang-switcher');
    if(!langSwitcher) return;

    const headerTranslations = {
      en: {
        headerSubtitle: "Coding, Robot & AI",
        headerHome: "Home",
        headerCourses: "Courses",
        headerCoaching: "Coaching",
        headerPlay: "Play & Learn ‚ñæ",
        headerTutorials: "üöÄ All Tutorials",
        headerGames: "üéÆ All Games",
        headerQuiz: "‚ùì All Quiz",
        headerRobotics: "ü§ñ Robotics",
        headerRegister: "Register for free",
        headerDonation: "‚ù§Ô∏è Donation",
        headerContact: "Contact"
      },
      fr: {
        headerSubtitle: "Coding, Robot & IA",
        headerHome: "Accueil",
        headerCourses: "Cours",
        headerCoaching: "Encadrement",
        headerPlay: "Joue & Apprends ‚ñæ",
        headerTutorials: "üöÄ Tous les Tutoriels",
        headerGames: "üéÆ Tous les Jeux",
        headerQuiz: "‚ùì Tous les Quiz",
        headerRobotics: "ü§ñ Robotique",
        headerRegister: "S'inscrire gratuitement",
        headerDonation: "‚ù§Ô∏è Faire un don",
        headerContact: "Contact"
      }
    };

    let currentLang = 'fr';

    function updateHeader(lang) {
      const trans = headerTranslations[lang];
      if(!trans) return;
      document.querySelectorAll('[data-lang-key]').forEach(el => {
        if(trans[el.dataset.langKey]) el.textContent = trans[el.dataset.langKey];
      });
      langSwitcher.textContent = lang === 'fr' ? 'EN' : 'FR';
      currentLang = lang;
    }

    langSwitcher.addEventListener('click', function() {
      const newLang = currentLang === 'fr' ? 'en' : 'fr';
      updateHeader(newLang);
    });
  })();
</script>